---
title: "[Spring] ìŠ¤í”„ë§ MVC 1 - Servlet"
tags: 
    - Study
    - Spring
categories:
    - Spring
---

>ğŸ’¡Refferecne [[ì™¸ë¶€ ë§í¬]ìŠ¤í”„ë§ MVC 1í¸ - ë°±ì—”ë“œ ì›¹ ê°œë°œ í•µì‹¬ ê¸°ìˆ  ](https://inf.run/Gmptq) 
> 1. **Spring MVC 1 - Servlet**

## 1. ê°œìš”
ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ê°€ ì—†ë˜ ì‹œì ˆë¡œ ëŒì•„ê°€ì„œ ì–´ë–»ê²Œ ì‚¬ìš©ìê°€ ìš”ì²­í•œ í˜ì´ì§€ë¥¼ ì°¾ì•„ë‚´ê³  í•„ìš”í•œ ë°ì´í„°(Payload) ë¥¼ ê°€ê³µí•˜ì—¬ ì²˜ë¦¬, ì‘ë‹µí•˜ì˜€ëŠ”ì§€ ì•Œì•„ë³´ì. 
ë˜í•œ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì˜ í•µì‹¬ì ì¸ ì—­í• ì„ íŒŒì•…í•˜ê¸° ìœ„í•´ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ í˜•íƒœì˜ ë‚˜ë§Œì˜ í”„ë ˆì„ì›Œí¬ë¥¼ ì§ì ‘ ì œì‘í•´ë³´ì.

## 2. Servlet
ìš°ì„  ë‹¤ìŒ ë‘ ê°€ì§€ ìš©ì–´ë¥¼ ì •ë¦¬í•˜ê³  ë„˜ì–´ê°€ì.

- Web Server
    - ì •ì  ë¦¬ì†ŒìŠ¤ íŒŒì¼ì„ ì œê³µ
    - ì˜ ë‹¤ìš´ë˜ì§€ ì•Šê³  ë¹„ìš©ì´ ì ìŒ 
    - Nginx, Apache ë“±
- WAS (Web Application Server)
    - ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì„ ì´ìš©í•˜ì—¬ ë™ì ì¸ ë°ì´í„° ë°˜í™˜ (ì •ì  ë¦¬ì†ŒìŠ¤ë„ ì œê³µí•  ìˆ˜ ìˆìŒ)
    - í”„ë¡œê·¸ë¨ ì½”ë“œë¥¼ ì‹¤í–‰ (JAVAì˜ ê²½ìš° Servlet)
    - ë‹¤ìš´ ë¹ˆë„ê°€ ë†’ê³  ë¹„ìš©ì´ ë¹„ìŒˆ
    - Tomcat, Jetty ë“±

### [Servlet ì´ë€?]
ì›ë˜ëŒ€ë¡œë¼ë©´ ê°œë°œìëŠ” HTTP í†µì‹ ì„ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ë“¤ì„ í•´ì•¼ í•œë‹¤.
- ì†Œì¼“ ì—°ê²°
- ì „ë¬¸ íŒŒì‹±
- í—¤ë” í™•ì¸
- ìì› ìœ„ì¹˜ í™•ì¸
- **ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰**
- ì‘ë‹µ ì „ë¬¸ ìƒì„±
- ì†Œì¼“ ì¢…ë£Œ

í•˜ì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ë“¤ì„ ëª¨ë“  í†µì‹ ë§ˆë‹¤ ì§€ì—½ì ìœ¼ë¡œ ê´€ë¦¬/ë°˜ë³µ í•´ì£¼ëŠ” ê²ƒì€ ìƒì‚°ì„±ì´ ë§¤ìš° ë–¨ì–´ì§€ëŠ” ì‘ì—…ì´ ë  ê²ƒì´ë‹¤.
ì´ë¥¼ ìœ„í•´ Servlet ì—ì„œëŠ” ìš”ì²­ê³¼ ì‘ë‹µì„ `Request` ì™€ `Response` ë¡œ ì¶”ìƒí™” í•˜ì—¬ ê°œë°œìê°€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ìì²´ì— ì§‘ì¤‘í•˜ë„ë¡ ë„ì™€ì¤€ë‹¤.

ì•ì„œ WASê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì´ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ìš”ì²­ì— ëŒ€í•´ ë™ì ìœ¼ë¡œ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤ê³  í•˜ì˜€ë‹¤. 
ì´ ë•Œ JAVA ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ìš”ì²­ì— ì‘ë‹µí•˜ê¸° ìœ„í•œ ì»´í¬ë„ŒíŠ¸ê°€ ë°”ë¡œ `Servlet` ì´ë‹¤. 

í•˜ë‚˜ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì—¬ëŸ¬ê°œì˜ ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ (íšŒì›ê°€ì… ìš”ì²­, ê²Œì‹œê¸€ ì¡°íšŒ ìš”ì²­ ë“±) ë³µìˆ˜ ê°œì˜ ì„œë¸”ë¦¿ì„ WAS ì— ë“±ë¡í•˜ê³  ê´€ë¦¬í•  í•„ìš”ê°€ ìˆë‹¤. 
ì´ì²˜ëŸ¼ ë³µìˆ˜ì˜ ì„œë¸”ë¦¿ì„ ìˆ˜ìš©í•˜ë©° ì§€ì›í•˜ëŠ” í†°ìº£ê³¼ ê°™ì€ WAS ë¥¼ **ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ**ë¼ê³  í•œë‹¤.

{% include figure path='assets/images/posts/2023/2023-10-18-17-45-14.png' caption='í†°ìº£ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ' %}

ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ í•˜ëŠ” ìì„¸í•œ ì—­í• ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
- ê° ìš”ì²­ì— ëŒ€í•œ ì“°ë ˆë“œ ìƒì„± ë° ìƒëª…ì£¼ê¸° ê´€ë¦¬
- ìš”ì²­ë°›ì€ ìì› ìœ„ì¹˜ì™€ ì„œë¸”ë¦¿ ë§¤í•‘ (URL ë§¤í•‘)
- ì„œë¸”ë¦¿ ìƒëª…ì£¼ê¸° ê´€ë¦¬ (ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ ë¨)

ì—¬ê¸°ì„œ ì„œë¸”ë¦¿ì˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬ì— ëŒ€í•´ ì¡°ê¸ˆ ë” ìì„¸íˆ ì•Œì•„ë³´ìë©´, í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° íŠ¹ì • ì„œë¸”ë¦¿ì˜ ë¡œì§ì„ ìˆ˜í–‰í•´ë‹¬ë¼ëŠ” ìš”ì²­ì„ ë°›ê³  ë‚œ ë’¤ í•´ë‹¹ ì„œë¸”ë¦¿ì´ ì´ˆê¸°í™”(ì¸ìŠ¤í„´ìŠ¤ ìƒì„±) ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ `init()` ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ê´€ë¦¬í•˜ê³ , ì´ë¯¸ ìƒì„± ëœ ì¸ìŠ¤í„´ìŠ¤ê°€ ì¡´ì¬í•œë‹¤ë©´ ì„œë¸”ë¦¿ì˜ `service()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•œë‹¤.

ì´ ë•Œ ì„œë¸”ë¦¿ ë‚´ì—ì„œ ì–´ë–¤ HTTP ë©”ì†Œë“œë¥¼ ì²˜ë¦¬í• ì§€ ë¶„ê¸°í•  ìˆ˜ ìˆë‹¤. ìƒì„± ëœ ì„œë¸”ë¦¿ì€ ì„ì˜ë¡œ ì¢…ë£Œí•˜ì§€ ì•Šìœ¼ë©´ í†°ìº£ì´ ì¢…ë£Œë  ë•Œ `destroy()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì¢…ë£Œí•œë‹¤.

### [Servlet ìƒëª…ì£¼ê¸°]
{% include figure path='assets/images/posts/2023/2023-10-19-14-32-05.png' caption='Servlet Lifecycle' %}

ì„œë¸”ë¦¿ì— ëŒ€í•œ ìš”ì²­ì´ ë°œìƒí•˜ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” ìš°ì„  í•´ë‹¹ ì„œë¸”ë¦¿ì´ ìƒì„±(ì¸ìŠ¤í„´ìŠ¤ í™”) ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.

ìƒì„± ëœ ì„œë¸”ë¦¿ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ `init()` ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.
ì„œë¸”ë¦¿ì€ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ë˜ê¸° ë•Œë¬¸ì— ê¸°ì¡´ì— ë§Œë“¤ì–´ì§„ ì„œë¸”ë¦¿ì´ ì¡´ì¬í•œë‹¤ë©´ `service()` ë©”ì†Œë“œë¡œ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ë§Œì„ ìˆ˜í–‰í•œë‹¤.

ë§Œë“¤ì–´ì§„ ì„œë¸”ë¦¿ë“¤ì€ í†°ìº£ ì¢…ë£Œ ì‹œ `destroy()` ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¢…ë£Œí•œë‹¤.

### [Servlet ì§ì ‘ ì‚¬ìš©í•˜ê¸°]
ì´ì œë¶€í„° ì„œë¸”ë¦¿ì„ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì— ì‘ë‹µí•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ë³´ì.
ìš°ì„  [start.spring.io](https://start.spring.io) Spring Web ë° Lombok ì •ë„ ì¶”ê°€í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ì„¸íŒ…í•œë‹¤. 
(gradle, Java 11, Spring 2.7.x, war)

SpringBoot ì—ì„œëŠ” ë©”ì¸ ì‹¤í–‰ ì§€ì ì˜ `@SpringBootApplication` ì• ë…¸í…Œì´ì…˜ ìœ„ì— `@ServletComponentScan` ì• ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì£¼ëŠ” ê²ƒìœ¼ë¡œ ì„œë¸”ë¦¿ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•œë‹¤. 

```java
@ServletComponentScan
@SpringBootApplication
public class FrameworkApplication {
	public static void main(String[] args) {
		SpringApplication.run(FrameworkApplication.class, args);
	}
}
```

ì²«ë²ˆì§¸ ì„œë¸”ë¦¿ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•´ `@WebServlet` ì• ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì£¼ê³  `HttpServlet` ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ëŠ”ë‹¤.
ê·¸ë¦¬ê³  ì„œë¸”ë¦¿ì˜ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰ë¶€ì¸ `service()` ë©”ì†Œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œ í•˜ì—¬ ë¡œì§ì„ êµ¬í˜„í•œë‹¤.

ìš°ì„  ê°„ë‹¨í•˜ê²Œ ìš”ì²­ê³¼ ì‘ë‹µ ì •ë³´, ì¿¼ë¦¬ìŠ¤íŠ¸ë§ íŒŒë¼ë¯¸í„° ì •ë„ë¥¼ ì¶œë ¥í•´ë³´ì. ì„œë¸”ë¦¿ì— ì‘ë‹µì„ ì „ë‹¬í• ë•Œì—ëŠ” response ê°ì²´ì— ì§ì ‘ ì‘ë‹µ ë‚´ìš©ì„ ì‘ì„±í•˜ë©´ ëœë‹¤.

```java
@Slf4j
@WebServlet(name = "hello", urlPatterns = "/hello")
public class HelloServlet extends HttpServlet {

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        
        log.info("HelloServlet.service");
        log.info("request : {}", request);
        log.info("response: {}", response);

        String parameter = request.getParameter("parameter");
        log.info("parameter : {}", parameter);

        response.setContentType("text/plain");
        response.setCharacterEncoding("utf-8");
        response.getWriter().write("response :" + parameter);
    }
}
```

```text
2023-10-19 14:43:07.538  INFO 7851 --- [nio-8080-exec-3] me.jwjung.framework.basic.HelloServlet   : HelloServlet.service
2023-10-19 14:43:07.538  INFO 7851 --- [nio-8080-exec-3] me.jwjung.framework.basic.HelloServlet   : request : org.apache.catalina.connector.RequestFacade@7d506757
2023-10-19 14:43:07.538  INFO 7851 --- [nio-8080-exec-3] me.jwjung.framework.basic.HelloServlet   : response: org.apache.catalina.connector.ResponseFacade@17537908
2023-10-19 14:43:07.539  INFO 7851 --- [nio-8080-exec-3] me.jwjung.framework.basic.HelloServlet   : parameter : hello
```

## 3. Servlet í™œìš©

ì´ì œë¶€í„° ë³¸ê²©ì ìœ¼ë¡œ ì„œë¸”ë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•œ íšŒì›ê°€ì… ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ ë³¼ ì˜ˆì •ì´ë‹¤. ì„œë¸”ë¦¿ì€ MVC íŒ¨í„´ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• ì— ì†í•˜ê¸° ë•Œë¬¸ì— ë„ë©”ì¸ì„ ë‹´ë‹¹í•  íšŒì›ê³¼ íšŒì›ê°ì²´ì— ëŒ€í•œ ì €ì¥ì†Œë¥¼ ë¨¼ì € êµ¬í˜„í•´ë³´ì.

- íšŒì› ê°ì²´

```java
@Getter
@EqualsAndHashCode
public class Member {

    private long id;
    private String name;
    private int age;

    private Member() {};

    public Member(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
```

ì•„ì´ë””, ì´ë¦„, ë‚˜ì´ë¥¼ ê°€ì§„ ê°„ë‹¨í•œ íšŒì› ê°ì²´ë¥¼ ìƒì„± í–ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ ì €ì¥, ì¡°íšŒì •ë„ë¥¼ ì§€ì›í•˜ëŠ” ì €ì¥ì†Œ ê°ì²´ë¥¼ ìƒì„±í•´ë³´ì.

```java
public class MemberRepository {

    private static Map<Long, Member> store = new ConcurrentHashMap<>();
    private static AtomicLong sequence = new AtomicLong(0L);

    @Getter
    private static MemberRepository instance = new MemberRepository();

    public void save(Member member) {
        setIdWithReflection(member);
        store.put(member.getId(), member);
    }

    private void setIdWithReflection(Member member) {
        
        try {
            Class<Member> memberClass = Member.class;
            Field id = memberClass.getDeclaredField("id");
            id.setAccessible(true);
            id.set(member, sequence.incrementAndGet());
        } catch (NoSuchFieldException | IllegalAccessException e) {
            throw new IllegalStateException("Reflection Exception", e);
        }
    }

    public Member findById(Long id) {
        return store.get(id);
    }

    public List<Member> findAll() {
        return new ArrayList<>(store.values());
    }

    public void clearStore() {
        store.clear();
    }
}
```

ë’·ë‹¨ì˜ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì´ ì™„ì„±ë˜ì—ˆìœ¼ë¯€ë¡œ ì´ì œ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ í˜¸ì¶œ í•  view ë¥¼ ì œê³µí•´ì•¼ í•œë‹¤.

ìš°ì„ ì€ HTML ì„ ì´ìš©í•˜ì—¬ ê°„ë‹¨í•œ í¼ì„ í†µí•´ ê°€ì…ì„ ì²˜ë¦¬ í•  ì˜ˆì •ì´ë¯€ë¡œ HTML Form ì„ ì œê³µí•˜ëŠ” ì„œë¸”ë¦¿ì„ ì‘ì„±í•œë‹¤.

```java
@Slf4j
@WebServlet(name = "memberFormServlet", urlPatterns = "/servlet/members/new-form")
public class MemberFormServlet extends HttpServlet {

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        response.setContentType("text/html");
        response.setCharacterEncoding("utf-8");

        PrintWriter w = response.getWriter();
        StringBuilder htmlBuilder = new StringBuilder();
        String html = htmlBuilder
                .append("<!DOCTYPE html>\n")
                .append("<html>\n")
                .append("<head>\n")
                .append("    <meta charset=\"UTF-8\">\n")
                .append("    <title>Title</title>\n")
                .append("</head>\n")
                .append("<body>\n")
                .append("<form action=\"/servlet/members/save\" method=\"post\">\n")
                .append("    username: <input type=\"text\" name=\"username\" />\n")
                .append("    age:      <input type=\"text\" name=\"age\" />\n")
                .append(" <button type=\"submit\">ì „ì†¡</button>\n")
                .append("</form>\n")
                .append("</body>\n")
                .append("</html>\n").toString();
        w.write(html);
    }
}
```

ë¨¼ì € ì‘ì„±í•´ ë³¸ ì„œë¸”ë¦¿ê³¼ ë™ì¼í•˜ê²Œ html ë‚´ìš©ì„ ë¬¸ìì—´ë¡œ ì‘ì„±í•˜ì—¬ response ê°ì²´ì— ë°˜í™˜í•´ì£¼ë©´ ëœë‹¤.

ë‹¤ìŒìœ¼ë¡œ form ì˜ post ìš”ì²­ì„ ì²˜ë¦¬í•´ ì¤„ ì„œë¸”ë¦¿ë„ í•˜ë‚˜ ì‘ì„±í•˜ì.

```java
@WebServlet(name = "memberSaveServlet", urlPatterns = "/servlet/members/save")
public class MemberSaveServlet extends HttpServlet {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        Member member = new Member(username, age);
        memberRepository.save(member);

        response.setContentType("text/html");
        response.setCharacterEncoding("utf-8");
        PrintWriter w = response.getWriter();

        StringBuilder htmlBuilder = new StringBuilder();
        String html = htmlBuilder
                .append("<!DOCTYPE html>\n")
                .append("<html>\n")
                .append("<body>\n")
                .append("ì„±ê³µ\n")
                .append("<ul>")
                .append("    <li>id=" + member.getId() + "</li>\n")
                .append("    <li>username=" + member.getName() + "</li>\n")
                .append(" <li>age=" + member.getAge() +  "</li>\n")
                .append("</ul>\n")
                .append("</body>\n")
                .append("</html>").toString();
        w.write(html);
    }
}
```

{% include figure path='assets/images/posts/2023/2023-10-20-13-11-21.png' caption='memberFormServlet ì‘ë‹µ' %}

{% include figure path='assets/images/posts/2023/2023-10-20-13-11-01.png' caption='memberSaveServlet ì‘ë‹µ' %}

ì´ë¡œì¨ Servlet ì„ í™œìš©í•œ ìš°ë¦¬ì˜ ì²«ë²ˆì§¸ ë³µì¡í•œ(?) ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì´ ì™„ì„±ë˜ì—ˆë‹¤. ğŸ‰

### [ë¬¸ì œì ë“¤]
ì„œë¸”ë¦¿ì„ í†µí•´ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ë©´ì„œ HTTP ìŠ¤í™ì„ ì¶”ìƒí™” í•˜ì—¬ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í• ìˆ˜ëŠ” ìˆê²Œ ë˜ì—ˆì§€ë§Œ, ì„œë¸”ë¦¿ í•˜ë‚˜ì— í™”ë©´ê³¼ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì´ í†µí•©ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì§€ì†ì ì¸ ê°œë°œì— ë¶ˆí¸í•œ ì ë“¤ì´ ëª‡ê°€ì§€ ì¡´ì¬í•œë‹¤.

1. Java ë¬¸ìì—´ íƒ€ì…ìœ¼ë¡œ HTML ì„ ê´€ë¦¬í•˜ë¯€ë¡œ ë™ì ì¸ HTML ì„ ê·¸ë¦¬ê¸°ê°€ í˜ë“¤ë‹¤.
2. í™”ë©´ì„ ë³€ê²½í•˜ëŠ”ë° ì„œë¹„ìŠ¤ ë¡œì§ì´ ìƒˆë¡œ ë¹Œë“œë˜ê±°ë‚˜, ì„œë¹„ìŠ¤ ë¡œì§ì„ ë³€ê²½í•˜ëŠ”ë° í™”ë©´ë„ ê°™ì´ ë¹Œë“œê°€ ë˜ì–´ì•¼ í•œë‹¤.
3. ì½”ë“œê°€ ë„ˆë¬´ ê¸¸ì–´ì§„ë‹¤.

ê²°êµ­ ì´ëŠ” í™”ë©´(View)ê³¼ ì„œë¹„ìŠ¤(Service)ì˜ ì±…ì„ì´ ë¶„ë¦¬ë˜ì§€ ì•Šì•„ì„œ ë°œìƒí•˜ëŠ” ì¼ë¡œ, ì´ë¥¼ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ **í…œí”Œë¦¿ ì—”ì§„** ì„ ì‚¬ìš©í•œë‹¤. ìµœê·¼ì—ëŠ” ìŠ¤í”„ë§ ì§„ì˜ì—ì„œ ëŒ€í‘œì ì¸ í…œí”Œë¦¿ ì—”ì§„ìœ¼ë¡œ íƒ€ì„ë¦¬í”„ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ë‹¹ì‹œì—ëŠ” JSP ë¥¼ ë§ì´ ì‚¬ìš©í•˜ì˜€ìœ¼ë¯€ë¡œ ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œë„ JSP ë¥¼ ì´ìš©í•´ë³´ì. 

## 4. JSP
ìš°ì„  Spring Boot í”„ë¡œì íŠ¸ì—ì„œ JSP ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” build.gradle ì— ë‹¤ìŒ ì˜ì¡´ì„±ë“¤ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤.

```groovy
implementation 'org.apache.tomcat.embed:tomcat-embed-jasper' 
implementation 'javax.servlet:jstl'
```

ê·¸ë¦¬ê³ ëŠ” ìœ„ì—ì„œ ë¬¸ìì—´ë¡œ ê´€ë¦¬í–ˆë˜ HTML ì†ŒìŠ¤ë¥¼ JSP íŒŒì¼ë¡œ ì˜®ê²¨ë³´ì.

- íšŒì›ê°€ì… ì–‘ì‹

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<form action="/jsp/members/save.jsp" method="post">
    username: <input type="text" name="username"/>
    age: <input type="text" name="age"/>
    <button type="submit">ì „ì†¡</button>
</form>
</body>
</html>
```

- íšŒì›ê°€ì… ì™„ë£Œ

```jsp
<%@ page import="me.jwjung.framework.basic.domain.member.MemberRepository" %>
<%@ page import="me.jwjung.framework.basic.domain.member.Member" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%
    //request, response ì‚¬ìš© ê°€ëŠ¥
    MemberRepository memberRepository = MemberRepository.getInstance();
    String username = request.getParameter("username");
    int age = Integer.parseInt(request.getParameter("age"));
    Member member = new Member(username, age);
    System.out.println("member = " + member);
    memberRepository.save(member);
%>
<html>
<head>
    <meta charset="UTF-8">
</head>
<body>
ì„±ê³µ
<ul>
    <li>id=<%=member.getId()%></li>
    <li>username=<%=member.getName()%></li>
    <li>age=<%=member.getAge()%></li>
</ul>
</body>
</html>
```

í•´ë‹¹ jsp íŒŒì¼ë“¤ì„ main/webapp/ í•˜ìœ„ ê²½ë¡œì— ìœ„ì¹˜ì‹œí‚¤ê³  í™•ì¥ìë¥¼ í¬í•¨í•˜ì—¬ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.

ì˜ˆ) localhost:8080/jsp/members/new-form.jsp


## 5. MVC íŒ¨í„´

### [ë“±ì¥ ë°°ê²½]

jsp íŒŒì¼ì— HTML ì½”ë“œ ë° ëª‡ê°€ì§€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ ì´ê´€í•œ ê²°ê³¼ ë™ì ìœ¼ë¡œ HTML ì„ ê·¸ë¦¬ëŠ” ë¬¸ì œëŠ” í•´ê²°ë˜ì—ˆë‹¤. í•˜ì§€ë§Œ ëŒ€ìƒì´ servlet ì½”ë“œì—ì„œ jsp ë¡œ ì˜®ê²¨ì™”ì„ ë¿ HTML ì½”ë“œì™€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§, íŠ¹íˆ ì €ì¥ì†Œë¥¼ ì˜¤ê³ ê°€ëŠ” ë¡œì§ê¹Œì§€ ë„ˆë¬´ ë§ì€ ì—­í• ì„ í•œìª½(JSP) ì—ì„œ ë‹´ë‹¹í•˜ê³  ìˆìœ¼ë¯€ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œë“¤ì€ ì—¬ì „íˆ í•´ê²°ë˜ì§€ ì•Šì•˜ë‹¤.

1. ì—¬ì „íˆ í•œ ìª½ì˜ ì½”ë“œê°€ ë„ˆë¬´ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆì„ ë¿ë”ëŸ¬, ì—°ê´€ ì—†ëŠ” ë ˆì´ì–´ì˜ ì½”ë“œë“¤ì´ í˜¼ì¬í•´ìˆë‹¤.
2. View ì™€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì˜ **ë³€ê²½ì˜ ë¼ì´í”„ì‚¬ì´í´** ì´ ì„œë¡œ ë‹¤ë¥´ë‹¤ëŠ” ì ì´ë‹¤. ë°”ê¿” ë§í•˜ìë©´ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ë¥¼ ìˆ˜ì •í•˜ëŠ” ì£¼ê¸°ì™€ í™”ë©´ì„ ë³€ê²½í•´ì•¼ í•˜ëŠ” ì£¼ê¸°ê°€ ì™„ì „íˆ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ë‹¤.
3. ë°ì´í„°ë¥¼ ë™ì ìœ¼ë¡œ ì¶œë ¥í•˜ëŠ” ë°ì— íŠ¹í™”ë˜ì–´ ìˆëŠ” ê²ƒì´ í…œí”Œë¦¿ ì—”ì§„ì´ì§€ë§Œ ë•Œë¬¸ì— ê°ì ì˜í•˜ëŠ” ê¸°ëŠ¥ë§Œ ë§¡ì•„ì„œ í•  ìˆ˜ê°€ ì—†ë‹¤.

ì´ëŸ° ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´ êµ¬ì¡°ì  ê°œì„  ë°©ì•ˆìœ¼ë¡œ MVC íŒ¨í„´ì´ ë“±ì¥í•˜ê²Œ ëœë‹¤.

### [MVC íŒ¨í„´ êµ¬ì¡°]

MVC íŒ¨í„´ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìš”ì†Œë“¤ì´ í•„ìš”í•˜ë‹¤.

**Controller**  
HTTP í†µì‹ ì˜ ì°½êµ¬ê°€ ë˜ë©°, í™”ë©´ì— ì „ë‹¬í•  ë°ì´í„°ë¥¼ ê°€ê³µí•œë‹¤. ì´ë•Œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê±°ë‚˜ ì¡°íšŒí•˜ëŠ” ë“±ì˜ ë³µì¡í•œ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì€ ì—­í• ì„ ë‹¤ì‹œ ë¶„ì‚°í•˜ê¸° ìœ„í•´ ì„œë¹„ìŠ¤ ë ˆì´ì–´ì— ìœ„ì„í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” `Model` ì— ì‘ë‹µ í•  ë°ì´í„°ë¥¼ ê°€ê³µí•˜ì—¬ ì „ë‹¬í•˜ëŠ” ì—­í• ë§Œì„ ìˆ˜í–‰í•œë‹¤.

**View**  
ì•ì„œ JSP ì™€ ê°™ì´ Model ì„ í†µí•´ ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ ì¶œë ¥í•œë‹¤. ì´ ë•Œ, ë™ì ìœ¼ë¡œ í™”ë©´ì„ ë Œë”ë§ í•  ìˆ˜ ìˆë„ë¡ í…œí”Œë¦¿ ì—”ì§„ì—ì„œ ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.

**Model**  
Controller ì™€ View ì‚¬ì´ì˜ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ê¸° ìœ„í•œ ë§¤ê°œì²´ ì—­í• ì„ í•œë‹¤.

{% include figure path='assets/images/posts/2023/2023-10-23-17-42-41.png' caption='MVC íŒ¨í„´ ì´ì „ì˜ í˜¸ì¶œ êµ¬ì¡°' %}

{% include figure path='assets/images/posts/2023/2023-10-23-17-52-43.png' caption='MVC íŒ¨í„´ ì ìš© í›„ í˜¸ì¶œêµ¬ì¡°' %}

### [MVC íŒ¨í„´ ì ìš©]

ì•ì„œ ì‘ì„±í•œ ì½”ë“œë“¤ì„ MVC íŒ¨í„´ì— ë§ì¶° ë³€ê²½í•´ë³´ì. ìš°ì„  `MemberFormServlet` ì„ MVC ì—­í• ì— ë§ê²Œ ë·°ì™€ ì—°ê²°í•´ì¤€ë‹¤. ì´ë•Œ, ìƒˆë¡œ ë§Œë“¤ jsp í…œí”Œë¦¿ì€ WEB-INF í•˜ìœ„ ê²½ë¡œì— ìœ„ì¹˜ì‹œì¼œì¤€ë‹¤. WEB-INF í•˜ìœ„ ìì›ë“¤ì€ ê¸°ì¡´ì²˜ëŸ¼ ê²½ë¡œë§Œ ì…ë ¥í•˜ì—¬ ì‚¬ìš©ìê°€ ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë§‰ì„ ìˆ˜ ìˆë‹¤. ì¦‰, ë¬´ì¡°ê±´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•´ ë°˜í™˜ë˜ì–´ì•¼ í•œë‹¤.

```java
@WebServlet(name = "mvcMemberFormServlet", urlPatterns = "/servlet-mvc/members/new-form")
public class MvcMemberFormServlet extends HttpServlet {

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String viewPath = "/WEB-INF/views/new-form.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}
```

ì„œë¸”ë¦¿ì€ ì´ì œ view ì˜ ê²½ë¡œë§Œ dispatcher ë¥¼ í†µí•´ ë„˜ê²¨ì¤€ë‹¤. `dispatcher.forward()` ë©”ì†Œë“œëŠ” redirect ì™€ ë‹¤ë¥´ê²Œ ì„œë²„ ë‚´ì—ì„œ ì¬í˜¸ì¶œì´ ì¼ì–´ë‚˜ë¯€ë¡œ í´ë¼ì´ì–¸íŠ¸ê°€ í˜¸ì¶œì´ ë³€ê²½ëœ ê²ƒì„ ì¸ì§€í•˜ì§€ ëª»í•œë‹¤.

ë‹¤ìŒìœ¼ë¡œ ê¸°ì¡´ì˜ /members/new-form.jsp íŒŒì¼ì„ ë³µì‚¬í•´ì„œ WEB-INF í•˜ìœ„ì˜ ì ë‹¹í•œ ê²½ë¡œë¡œ ì˜®ê²¨ì£¼ê³ , Form íƒœê·¸ ë‚´ì˜ action ì†ì„± ê²½ë¡œë¥¼ ì ˆëŒ€ê²½ë¡œë¡œ ë³€ê²½í•´ì¤€ë‹¤. ì´ë ‡ê²Œ ìƒëŒ€ ê²½ë¡œë¡œ ë³€ê²½í•˜ë©´ í˜„ì¬ url ê²½ë¡œì—ì„œ ê³„ì¸µ ê²½ë¡œë¥¼ ìœ ì§€í•œì±„ ë§ˆì§€ë§‰ ìì› ìœ„ì¹˜ë§Œ ë³€ê²½ëœë‹¤.

- ê¸°ì¡´ Url: /servlet-mvc/members/new-form
- ì´ë™ Url: /servlet-mvc/members/save

```html
<form action="save" method="post">
    username: <input type="text" name="username"/>
    age: <input type="text" name="age"/>
    <button type="submit">ì „ì†¡</button>
</form>
```

ë‹¤ìŒìœ¼ë¡œ ì €ì¥ì„ ì‹¤ì œë¡œ ì‹¤í–‰í•˜ëŠ” ì„œë¸”ë¦¿ë„ MVC íŒ¨í„´ì„ ì ìš©í•´ë³´ì.

```java
@WebServlet(name = "mvcMemberSaveServlet", urlPatterns = "/servlet-mvc/members/save")
public class MvcMemberSaveServlet extends HttpServlet {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        Member member = new Member(username, age);
        System.out.println("member = " + member);
        memberRepository.save(member);

        //Model ì— ì €ì¥ëœ ë°ì´í„° ì €ì¥
        request.setAttribute("member", member);

        String viewPath = "/WEB-INF/views/save-result.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher("viewPath");
        dispatcher.forward(request, response);
    }
}
```

ì„œë¸”ë¦¿ì´ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ë§Œì„ ë“¤ê³ ê°€ê³  ì²˜ë¦¬ ê²°ê³¼ë¥¼ Model ì„ í†µí•´ view ë¡œ ë„˜ê¸°ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ì´ì œ view ì—ì„œëŠ” ë„˜ì–´ì˜¨ model ì˜ ë°ì´í„°ë¥¼ ë‹¨ìˆœíˆ ë Œë”ë§ í•˜ëŠ” ì—­í• ë§Œì„ ìˆ˜í–‰í•˜ë©´ ëœë‹¤. ë‹¤ìŒ ì½”ë“œë¥¼ ë³´ì

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <meta charset="UTF-8">
</head>
<body> ì„±ê³µ
<ul>
    <li>id=${member.id}</li>
    <li>username=${member.username}</li>
    <li>age=${member.age}</li>
</ul>
<a href="/index.html">ë©”ì¸</a>
</body>
</html>
```

model ì˜ ê°’ì„ el í‘œí˜„ì‹ìœ¼ë¡œ ê°€ì ¸ì™€ ë Œë”ë§ í•´ì£¼ëŠ” ì •ë„ ì´ì™¸ì˜ ë¡œì§ì€ ì „ë¶€ ì œê±°ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### [í•œê³„]

MVC íŒ¨í„´ì„ ì ìš©í•¨ìœ¼ë¡œì¨ ì´ˆê¸° ë¬¸ì œì˜€ë˜ ì—­í• ì´ ë¶„ì‚°ë˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œë¥¼ ì–´ëŠì •ë„ í•´ê²°í•œ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. í•˜ì§€ë§Œ ì•„ì§ ëª‡ ê°€ì§€ ë¬¸ì œì ë“¤ì´ ë‚¨ì•„ìˆë‹¤.

1. ì¤‘ë³µë˜ëŠ” ì½”ë“œë“¤
    - `dispatcher.forward()` í˜¸ì¶œì´ë‚˜, viewPath ì„ ì–¸ ë“±, ì»¨íŠ¸ë¡¤ëŸ¬ë³„ë¡œ ì¤‘ë³µë˜ëŠ” ì½”ë“œë“¤ì´ ì—¬ì „íˆ ë§ì´ ë‚¨ì•„ìˆë‹¤.
2. viewPath ë¥¼ ë‹¤ë£¨ëŠ” ë°©ì‹
    - ì „ì²´ê²½ë¡œì™€ í™•ì¥ìë¥¼ ë¬¸ìì—´ë¡œ ë‹¤ë£¨ê¸° ë•Œë¬¸ì— jsp íŒŒì¼ì„ ì´ë™ì‹œí‚¤ê±°ë‚˜, í…œí”Œë¦¿ í™•ì¥ìë¥¼ html ì´ë‚˜ ë‹¤ë¥¸ íŒŒì¼ë¡œ ë³€ê²½í•˜ë©´ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•œë‹¤.
3. request ê°ì²´ì™€ response ê°ì²´ ì„ ì–¸ì´ ê°•ì œ
    - request, response ê°ì²´ë¥¼ ìƒì‹œ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ì•„ë‹Œë° ì„ ì–¸ì´ ë˜ì–´ì•¼ í•œë‹¤. ì´ë¡œ ì¸í•´ í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„±ë“±ë„ ì–´ë ¤ì›Œì§„ë‹¤.
4. ê³µí†µì²˜ë¦¬ì˜ ì–´ë ¤ì›€
    - ê° ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ì´ ê³µí†µìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì´ ë§ì•„ì ¸ë„ ê°ê°ì˜ ì„œë¸”ë¦¿(ì»¨íŠ¸ë¡¤ëŸ¬)ì— ì²˜ë¦¬í•´ì£¼ì–´ì•¼ í•˜ë¯€ë¡œ ê³µí†µê¸°ëŠ¥ì„ ë¬¶ê¸°ê°€ ì–´ë µë‹¤.

ë‹¤ìŒ ì‹œê°„ì—ëŠ” ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ íŒ¨í„´ì„ ì ìš©í•œ ë‚˜ë§Œì˜ í”„ë ˆì„ì›Œí¬ë¥¼ ì œì‘í•´ë³´ë©´ì„œ í•´ê²°í•´ë³´ê³ , ìŠ¤í”„ë§ì´ ì´ëŸ¬í•œ ë¬¸ì œë“¤ì„ ì–´ë–»ê²Œ í•´ê²°í•˜ì˜€ëŠ”ì§€ ì•Œì•„ë³´ë„ë¡ í•˜ê² ë‹¤.