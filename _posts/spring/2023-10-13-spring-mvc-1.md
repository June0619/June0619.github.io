---
title: "[Spring] ìŠ¤í”„ë§ MVC 1 - Servlet"
tags: 
    - Study
    - Spring
categories:
    - Spring
---

## 1. ê°œìš”
ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ê°€ ì—†ë˜ ì‹œì ˆë¡œ ëŒì•„ê°€ì„œ ì–´ë–»ê²Œ ì‚¬ìš©ìê°€ ìš”ì²­í•œ í˜ì´ì§€ë¥¼ ì°¾ì•„ë‚´ê³  í•„ìš”í•œ ë°ì´í„°(Payload) ë¥¼ ê°€ê³µí•˜ì—¬ ì²˜ë¦¬, ì‘ë‹µí•˜ì˜€ëŠ”ì§€ ì•Œì•„ë³´ì. 
ë˜í•œ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì˜ í•µì‹¬ì ì¸ ì—­í• ì„ íŒŒì•…í•˜ê¸° ìœ„í•´ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ í˜•íƒœì˜ ë‚˜ë§Œì˜ í”„ë ˆì„ì›Œí¬ë¥¼ ì§ì ‘ ì œì‘í•´ë³´ì.

## 2. Servlet
ìš°ì„  ë‹¤ìŒ ë‘ ê°€ì§€ ìš©ì–´ë¥¼ ì •ë¦¬í•˜ê³  ë„˜ì–´ê°€ì.

- Web Server
    - ì •ì  ë¦¬ì†ŒìŠ¤ íŒŒì¼ì„ ì œê³µ
    - ì˜ ë‹¤ìš´ë˜ì§€ ì•Šê³  ë¹„ìš©ì´ ì ìŒ 
    - Nginx, Apache ë“±
- WAS (Web Application Server)
    - ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì„ ì´ìš©í•˜ì—¬ ë™ì ì¸ ë°ì´í„° ë°˜í™˜ (ì •ì  ë¦¬ì†ŒìŠ¤ë„ ì œê³µí•  ìˆ˜ ìˆìŒ)
    - í”„ë¡œê·¸ë¨ ì½”ë“œë¥¼ ì‹¤í–‰ (JAVAì˜ ê²½ìš° Servlet)
    - ë‹¤ìš´ ë¹ˆë„ê°€ ë†’ê³  ë¹„ìš©ì´ ë¹„ìŒˆ
    - Tomcat, Jetty ë“±

### [Servlet ì´ë€?]
ì›ë˜ëŒ€ë¡œë¼ë©´ ê°œë°œìëŠ” HTTP í†µì‹ ì„ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ë“¤ì„ í•´ì•¼ í•œë‹¤.
- ì†Œì¼“ ì—°ê²°
- ì „ë¬¸ íŒŒì‹±
- í—¤ë” í™•ì¸
- ìì› ìœ„ì¹˜ í™•ì¸
- **ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰**
- ì‘ë‹µ ì „ë¬¸ ìƒì„±
- ì†Œì¼“ ì¢…ë£Œ

í•˜ì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ë“¤ì„ ëª¨ë“  í†µì‹ ë§ˆë‹¤ ì§€ì—½ì ìœ¼ë¡œ ê´€ë¦¬/ë°˜ë³µ í•´ì£¼ëŠ” ê²ƒì€ ìƒì‚°ì„±ì´ ë§¤ìš° ë–¨ì–´ì§€ëŠ” ì‘ì—…ì´ ë  ê²ƒì´ë‹¤.
ì´ë¥¼ ìœ„í•´ Servlet ì—ì„œëŠ” ìš”ì²­ê³¼ ì‘ë‹µì„ `Request` ì™€ `Response` ë¡œ ì¶”ìƒí™” í•˜ì—¬ ê°œë°œìê°€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ìì²´ì— ì§‘ì¤‘í•˜ë„ë¡ ë„ì™€ì¤€ë‹¤.

ì•ì„œ WASê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì´ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ìš”ì²­ì— ëŒ€í•´ ë™ì ìœ¼ë¡œ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤ê³  í•˜ì˜€ë‹¤. 
ì´ ë•Œ JAVA ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ìš”ì²­ì— ì‘ë‹µí•˜ê¸° ìœ„í•œ ì»´í¬ë„ŒíŠ¸ê°€ ë°”ë¡œ `Servlet` ì´ë‹¤. 

í•˜ë‚˜ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì—¬ëŸ¬ê°œì˜ ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ (íšŒì›ê°€ì… ìš”ì²­, ê²Œì‹œê¸€ ì¡°íšŒ ìš”ì²­ ë“±) ë³µìˆ˜ ê°œì˜ ì„œë¸”ë¦¿ì„ WAS ì— ë“±ë¡í•˜ê³  ê´€ë¦¬í•  í•„ìš”ê°€ ìˆë‹¤. 
ì´ì²˜ëŸ¼ ë³µìˆ˜ì˜ ì„œë¸”ë¦¿ì„ ìˆ˜ìš©í•˜ë©° ì§€ì›í•˜ëŠ” í†°ìº£ê³¼ ê°™ì€ WAS ë¥¼ **ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ**ë¼ê³  í•œë‹¤.

{% include figure path='assets/images/posts/2023/2023-10-18-17-45-14.png' caption='í†°ìº£ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ' %}

ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ í•˜ëŠ” ìì„¸í•œ ì—­í• ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
- ê° ìš”ì²­ì— ëŒ€í•œ ì“°ë ˆë“œ ìƒì„± ë° ìƒëª…ì£¼ê¸° ê´€ë¦¬
- ìš”ì²­ë°›ì€ ìì› ìœ„ì¹˜ì™€ ì„œë¸”ë¦¿ ë§¤í•‘ (URL ë§¤í•‘)
- ì„œë¸”ë¦¿ ìƒëª…ì£¼ê¸° ê´€ë¦¬ (ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ ë¨)

ì—¬ê¸°ì„œ ì„œë¸”ë¦¿ì˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬ì— ëŒ€í•´ ì¡°ê¸ˆ ë” ìì„¸íˆ ì•Œì•„ë³´ìë©´, í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° íŠ¹ì • ì„œë¸”ë¦¿ì˜ ë¡œì§ì„ ìˆ˜í–‰í•´ë‹¬ë¼ëŠ” ìš”ì²­ì„ ë°›ê³  ë‚œ ë’¤ í•´ë‹¹ ì„œë¸”ë¦¿ì´ ì´ˆê¸°í™”(ì¸ìŠ¤í„´ìŠ¤ ìƒì„±) ë˜ì–´ìˆì§€ ì•Šë‹¤ë©´ `init()` ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ê´€ë¦¬í•˜ê³ , ì´ë¯¸ ìƒì„± ëœ ì¸ìŠ¤í„´ìŠ¤ê°€ ì¡´ì¬í•œë‹¤ë©´ ì„œë¸”ë¦¿ì˜ `service()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•œë‹¤.

ì´ ë•Œ ì„œë¸”ë¦¿ ë‚´ì—ì„œ ì–´ë–¤ HTTP ë©”ì†Œë“œë¥¼ ì²˜ë¦¬í• ì§€ ë¶„ê¸°í•  ìˆ˜ ìˆë‹¤. ìƒì„± ëœ ì„œë¸”ë¦¿ì€ ì„ì˜ë¡œ ì¢…ë£Œí•˜ì§€ ì•Šìœ¼ë©´ í†°ìº£ì´ ì¢…ë£Œë  ë•Œ `destroy()` ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì¢…ë£Œí•œë‹¤.

### [Servlet ìƒëª…ì£¼ê¸°]
{% include figure path='assets/images/posts/2023/2023-10-19-14-32-05.png' caption='Servlet Lifecycle' %}

ì„œë¸”ë¦¿ì— ëŒ€í•œ ìš”ì²­ì´ ë°œìƒí•˜ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” ìš°ì„  í•´ë‹¹ ì„œë¸”ë¦¿ì´ ìƒì„±(ì¸ìŠ¤í„´ìŠ¤ í™”) ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.

ìƒì„± ëœ ì„œë¸”ë¦¿ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ `init()` ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.
ì„œë¸”ë¦¿ì€ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ë˜ê¸° ë•Œë¬¸ì— ê¸°ì¡´ì— ë§Œë“¤ì–´ì§„ ì„œë¸”ë¦¿ì´ ì¡´ì¬í•œë‹¤ë©´ `service()` ë©”ì†Œë“œë¡œ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ë§Œì„ ìˆ˜í–‰í•œë‹¤.

ë§Œë“¤ì–´ì§„ ì„œë¸”ë¦¿ë“¤ì€ í†°ìº£ ì¢…ë£Œ ì‹œ `destroy()` ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¢…ë£Œí•œë‹¤.

### [Servlet ì§ì ‘ ì‚¬ìš©í•˜ê¸°]
ì´ì œë¶€í„° ì„œë¸”ë¦¿ì„ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì— ì‘ë‹µí•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ë³´ì.
ìš°ì„  [start.spring.io](https://start.spring.io) Spring Web ë° Lombok ì •ë„ ì¶”ê°€í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ì„¸íŒ…í•œë‹¤. 
(gradle, Java 11, Spring 2.7.x, war)

SpringBoot ì—ì„œëŠ” ë©”ì¸ ì‹¤í–‰ ì§€ì ì˜ `@SpringBootApplication` ì• ë…¸í…Œì´ì…˜ ìœ„ì— `@ServletComponentScan` ì• ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì£¼ëŠ” ê²ƒìœ¼ë¡œ ì„œë¸”ë¦¿ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•œë‹¤. 

```java
@ServletComponentScan
@SpringBootApplication
public class FrameworkApplication {
	public static void main(String[] args) {
		SpringApplication.run(FrameworkApplication.class, args);
	}
}
```

ì²«ë²ˆì§¸ ì„œë¸”ë¦¿ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•´ `@WebServlet` ì• ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì£¼ê³  `HttpServlet` ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ëŠ”ë‹¤.
ê·¸ë¦¬ê³  ì„œë¸”ë¦¿ì˜ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰ë¶€ì¸ `service()` ë©”ì†Œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œ í•˜ì—¬ ë¡œì§ì„ êµ¬í˜„í•œë‹¤.

ìš°ì„  ê°„ë‹¨í•˜ê²Œ ìš”ì²­ê³¼ ì‘ë‹µ ì •ë³´, ì¿¼ë¦¬ìŠ¤íŠ¸ë§ íŒŒë¼ë¯¸í„° ì •ë„ë¥¼ ì¶œë ¥í•´ë³´ì. ì„œë¸”ë¦¿ì— ì‘ë‹µì„ ì „ë‹¬í• ë•Œì—ëŠ” response ê°ì²´ì— ì§ì ‘ ì‘ë‹µ ë‚´ìš©ì„ ì‘ì„±í•˜ë©´ ëœë‹¤.

```java
@Slf4j
@WebServlet(name = "hello", urlPatterns = "/hello")
public class HelloServlet extends HttpServlet {

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        
        log.info("HelloServlet.service");
        log.info("request : {}", request);
        log.info("response: {}", response);

        String parameter = request.getParameter("parameter");
        log.info("parameter : {}", parameter);

        response.setContentType("text/plain");
        response.setCharacterEncoding("utf-8");
        response.getWriter().write("response :" + parameter);
    }
}
```

```text
2023-10-19 14:43:07.538  INFO 7851 --- [nio-8080-exec-3] me.jwjung.framework.basic.HelloServlet   : HelloServlet.service
2023-10-19 14:43:07.538  INFO 7851 --- [nio-8080-exec-3] me.jwjung.framework.basic.HelloServlet   : request : org.apache.catalina.connector.RequestFacade@7d506757
2023-10-19 14:43:07.538  INFO 7851 --- [nio-8080-exec-3] me.jwjung.framework.basic.HelloServlet   : response: org.apache.catalina.connector.ResponseFacade@17537908
2023-10-19 14:43:07.539  INFO 7851 --- [nio-8080-exec-3] me.jwjung.framework.basic.HelloServlet   : parameter : hello
```

## 3. Servlet í™œìš©

ì´ì œë¶€í„° ë³¸ê²©ì ìœ¼ë¡œ ì„œë¸”ë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•œ íšŒì›ê°€ì… ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ ë³¼ ì˜ˆì •ì´ë‹¤. ì„œë¸”ë¦¿ì€ MVC íŒ¨í„´ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• ì— ì†í•˜ê¸° ë•Œë¬¸ì— ë„ë©”ì¸ì„ ë‹´ë‹¹í•  íšŒì›ê³¼ íšŒì›ê°ì²´ì— ëŒ€í•œ ì €ì¥ì†Œë¥¼ ë¨¼ì € êµ¬í˜„í•´ë³´ì.

- íšŒì› ê°ì²´

```java
@Getter
@EqualsAndHashCode
public class Member {

    private long id;
    private String name;
    private int age;

    private Member() {};

    public Member(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
```

ì•„ì´ë””, ì´ë¦„, ë‚˜ì´ë¥¼ ê°€ì§„ ê°„ë‹¨í•œ íšŒì› ê°ì²´ë¥¼ ìƒì„± í–ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ ì €ì¥, ì¡°íšŒì •ë„ë¥¼ ì§€ì›í•˜ëŠ” ì €ì¥ì†Œ ê°ì²´ë¥¼ ìƒì„±í•´ë³´ì.

```java
public class MemberRepository {

    private static Map<Long, Member> store = new ConcurrentHashMap<>();
    private static AtomicLong sequence = new AtomicLong(0L);

    @Getter
    private static MemberRepository instance = new MemberRepository();

    public void save(Member member) {
        setIdWithReflection(member);
        store.put(member.getId(), member);
    }

    private void setIdWithReflection(Member member) {
        
        try {
            Class<Member> memberClass = Member.class;
            Field id = memberClass.getDeclaredField("id");
            id.setAccessible(true);
            id.set(member, sequence.incrementAndGet());
        } catch (NoSuchFieldException | IllegalAccessException e) {
            throw new IllegalStateException("Reflection Exception", e);
        }
    }

    public Member findById(Long id) {
        return store.get(id);
    }

    public List<Member> findAll() {
        return new ArrayList<>(store.values());
    }

    public void clearStore() {
        store.clear();
    }
}
```

ë’·ë‹¨ì˜ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì´ ì™„ì„±ë˜ì—ˆìœ¼ë¯€ë¡œ ì´ì œ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ í˜¸ì¶œ í•  view ë¥¼ ì œê³µí•´ì•¼ í•œë‹¤.

ìš°ì„ ì€ HTML ì„ ì´ìš©í•˜ì—¬ ê°„ë‹¨í•œ í¼ì„ í†µí•´ ê°€ì…ì„ ì²˜ë¦¬ í•  ì˜ˆì •ì´ë¯€ë¡œ HTML Form ì„ ì œê³µí•˜ëŠ” ì„œë¸”ë¦¿ì„ ì‘ì„±í•œë‹¤.

```java
@Slf4j
@WebServlet(name = "memberFormServlet", urlPatterns = "/servlet/members/new-form")
public class MemberFormServlet extends HttpServlet {

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        response.setContentType("text/html");
        response.setCharacterEncoding("utf-8");

        PrintWriter w = response.getWriter();
        StringBuilder htmlBuilder = new StringBuilder();
        String html = htmlBuilder
                .append("<!DOCTYPE html>\n")
                .append("<html>\n")
                .append("<head>\n")
                .append("    <meta charset=\"UTF-8\">\n")
                .append("    <title>Title</title>\n")
                .append("</head>\n")
                .append("<body>\n")
                .append("<form action=\"/servlet/members/save\" method=\"post\">\n")
                .append("    username: <input type=\"text\" name=\"username\" />\n")
                .append("    age:      <input type=\"text\" name=\"age\" />\n")
                .append(" <button type=\"submit\">ì „ì†¡</button>\n")
                .append("</form>\n")
                .append("</body>\n")
                .append("</html>\n").toString();
        w.write(html);
    }
}
```

ë¨¼ì € ì‘ì„±í•´ ë³¸ ì„œë¸”ë¦¿ê³¼ ë™ì¼í•˜ê²Œ html ë‚´ìš©ì„ ë¬¸ìì—´ë¡œ ì‘ì„±í•˜ì—¬ response ê°ì²´ì— ë°˜í™˜í•´ì£¼ë©´ ëœë‹¤.

ë‹¤ìŒìœ¼ë¡œ form ì˜ post ìš”ì²­ì„ ì²˜ë¦¬í•´ ì¤„ ì„œë¸”ë¦¿ë„ í•˜ë‚˜ ì‘ì„±í•˜ì.

```java
@WebServlet(name = "memberSaveServlet", urlPatterns = "/servlet/members/save")
public class MemberSaveServlet extends HttpServlet {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        Member member = new Member(username, age);
        memberRepository.save(member);

        response.setContentType("text/html");
        response.setCharacterEncoding("utf-8");
        PrintWriter w = response.getWriter();

        StringBuilder htmlBuilder = new StringBuilder();
        String html = htmlBuilder
                .append("<!DOCTYPE html>\n")
                .append("<html>\n")
                .append("<body>\n")
                .append("ì„±ê³µ\n")
                .append("<ul>")
                .append("    <li>id=" + member.getId() + "</li>\n")
                .append("    <li>username=" + member.getName() + "</li>\n")
                .append(" <li>age=" + member.getAge() + "</li>\n")
                .append("</ul>\n")
                .append("</body>\n")
                .append("</html>").toString();
        w.write(html);
    }
}
```

{% include figure path='assets/images/posts/2023/2023-10-20-13-11-21.png' caption='memberFormServlet ì‘ë‹µ' %}

{% include figure path='assets/images/posts/2023/2023-10-20-13-11-01.png' caption='memberSaveServlet ì‘ë‹µ' %}

ì´ë¡œì¨ Servlet ì„ í™œìš©í•œ ìš°ë¦¬ì˜ ì²«ë²ˆì§¸ ë³µì¡í•œ(?) ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì´ ì™„ì„±ë˜ì—ˆë‹¤. ğŸ‰

### [ë¬¸ì œì ë“¤]
ì„œë¸”ë¦¿ì„ í†µí•´ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ë©´ì„œ HTTP ìŠ¤í™ì„ ì¶”ìƒí™” í•˜ì—¬ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í• ìˆ˜ëŠ” ìˆê²Œ ë˜ì—ˆì§€ë§Œ, í¬ê²Œ ë¶ˆí¸í•œ ì ë“¤ì´ ëª‡ê°€ì§€ ì¡´ì¬í•œë‹¤.

1. ë™ì ì¸ HTML ì„ ê·¸ë¦¬ê¸°ê°€ í˜ë“¤ë‹¤.
2. 
