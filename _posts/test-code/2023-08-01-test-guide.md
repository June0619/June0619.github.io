---
title: "[Test] 테스트 코드 작성해보기"
tags: 
    - test-code
    - Spring
categories:
    - Test
slug: '테스트-코드-작성해보기'
draft: true
---

## 1. 개요
최근에는 많은 강의나 개발자들의 블로그에서 수도 없이 테스트 코드의 중요성에 대해 강조하고 있다.

하지만 처음에는 테스트 코드 작성에 시간도 많이 걸리고 반복 작업도 많기 때문에 실제로 테스트 코드를 작성하고 장애를 예방해본 경험이 없으면 그 가치를 받아들이기 힘들수도 있다. 

그럼에도 불구하고 테스트 코드 작성에 관심을 가지고 첫 발을 떼기 위해 테스트 코드를 작성하면 무엇이 좋은지, 또 어떻게 작성해야 할 지 고민했던 것들을 한번 정리해볼까 한다.

## 2. 테스트 코드의 목적 🚩
우선 다음과 같은 클래스가 존재한다고 생각해보자. 

```java
public class Calculator {

    public int summary(int... numbers) {
        return Arrays.stream(numbers).sum();
    }
}   
```

방금 작성한 `summary` 메소드는 N 개의 정수를 들어오는대로 합쳐주는 간단한 계산 기능을 가지고 있다.

해당 메소드는 직관적으로 기대하는 결과값을 알아낼 수 있다.

하지만 테스트 코드를 굳이 한번 작성해보자.

```java
class CalculatorTest {

    Calculator cal = new Calculator();

    @Test
    void summaryTest() {
        
        int sum = cal.summary(1, 2, 3);
        //sum 의 결과가 정수 6과 동일한지 확인
        assertThat(sum).isEqualTo(6);
    }
}
```

테스트는 당연히 성공하겠지만 실제 비지니스 로직은 이렇게 단순하지 않을 것이다.

누군가 계속되는 야근에 지쳐 정신나간 계산기를 만들었다는 상황을 가정하고 코드에 반영해보자.

```java
public int summary(int... numbers) {
        int sum = 0;
        int length = numbers.length;

        for (int i = 1; i <= length; i++) {
            sum += numbers[i];
        }

        return sum;
    }
```

당연히 첫 번째 `summary` 메소드와 마찬가지로 인자가 모두 합산되어 나오는 결과를 기대하기 때문에 테스트 코드도 동일할 것이다.
하지만 아래 메소드를 실행하면 결과는 out of bound 예외로 인해 당연히 실패가 된다.

{% include figure path='assets/images/posts/2023/2023-08-17-17-48-24.png' caption='pass 하던 테스트의 갑작스런 실패' %}

방금 실시한 일련의 결과에서 테스트 코드의 핵심 역할은 바로 **변경된 코드에서 발생하는 에러의 예방**이다.

테스트 코드를 실행함으로써 로직에 문제가 있음을 발견했지만, 급한 마음에 테스트 없이 운영중인 서비스에 반영되었다면 바로 장애가 되기 때문이다.

그리고 예제를 위해 짧고 단순한 코드를 가져왔지만, 실제 비지니스 로직은 훨씬 더 복잡하고 변경이 야기할 수 있는 사이드 이펙트도 범위가 크기 때문에 한눈에 문제를 발견하기 어렵다.

물론 OCP 원칙에 입각해서 실제 로직을 수정하지 않고 확장하는 것이 더 좋은 설계이긴 하지만 V2 로 작성하는 메소드 역시 V1 의 메소드와 동일한 결과를 기대해야 하는 부분이 있을 것이다.

이러한 부분들에 대한 테스트 코드가 잘 설계되어 있다면 변경이나 확장에 대한 두려움을 줄일 수 있다는 장점이 있다.

## 3. 테스트 코드 작성






## 4. 통합 테스트

## 5. 단위 테스트